(()=>{var t={351:t=>{t.exports=class{constructor(){this.bomb=!1,this.number=0,this.visible=!1,this.flagged=!1,this.hasExploded=!1}isFlagged(){return this.flagged}toggleFlag(){this.flagged=!this.flagged}isVisible(){return this.visible}setVisible(){this.visible=!0}hasBomb(){return this.bomb}setBomb(){this.bomb=!0}setExploded(){this.hasExploded=!0}getExploded(){return this.hasExploded}getNumber(){return this.number}setNumber(t){this.number=t}toString(){return this.bomb?"B":this.number.toString()}drawBomb(t,e,i,s,l,o){t.fillStyle="black",t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-s-l),t.lineTo(e,i+s+l),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-s-l,i),t.lineTo(e+s+l,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-s/1.5-l,i-s/1.5-l),t.lineTo(e+s/1.5+l,i+s/1.5+l),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+s/1.5+l,i-s/1.5-l),t.lineTo(e-s/1.5-l,i+s/1.5+l),t.stroke(),t.closePath(),t.lineWidth=1;const r=t.createLinearGradient(e-s,i-s,e+s/2,i+s/2);r.addColorStop(0,"grey"),r.addColorStop(1,"black"),t.fillStyle=r,t.beginPath(),t.arc(e,i,s-2,0,2*Math.PI),t.fill(),t.closePath(),o?(t.fillStyle="red",t.beginPath(),t.arc(e,i,s/4,0,2*Math.PI),t.fill(),t.closePath()):(t.fillStyle="black",t.beginPath(),t.arc(e,i,s/4,0,2*Math.PI),t.fill(),t.closePath())}drawCellContent(t,e,i,s){const l=i*s+s/2,o=e*s+s/2,r=s/4;if(this.visible)if(this.hasBomb())this.getExploded()?this.drawBomb(t,l,o,r,4,!0):this.drawBomb(t,l,o,r,4);else{let l="#000000";if(1===this.getNumber())l="blue";else if(2===this.getNumber())l="green";else if(3===this.getNumber())l="red";else if(4===this.getNumber())l="#00008B";else if(5===this.getNumber())l="#8B0000";else if(6===this.getNumber())l="#00FFFF";else if(7===this.getNumber())l="black";else if(8===this.getNumber())l="grey";else if(0===this.getNumber())return;t.fillStyle="#f9f8f5",t.fillRect(i*s,e*s,s,s),t.fillStyle=l,t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.toString(),i*s+s/2,e*s+s/2)}else t.fillStyle="#999999",t.fillRect(i*s,e*s,s,s),this.flagged&&(t.fillStyle="#ff0000",t.beginPath(),t.moveTo(l-2,o+r),t.lineTo(l-3.5,o-1),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(l-3,o-1),t.lineTo(l-r/2,o-r-4),t.stroke(),t.lineTo(l+r+4,o-r/2-4),t.stroke(),t.lineTo(l-3,o-1),t.stroke(),t.closePath(),t.fill(),t.beginPath(),t.moveTo(l-8,o+r),t.lineTo(l+4,o+r),t.stroke(),t.closePath())}}},886:(t,e,i)=>{const s=i(351);t.exports=class{DIFFICULTY_NORMAL=.15;constructor(t,e,i,l=[]){this.length=t,this.width=e,this.matrix=[],this.numbombs=i;for(let i=0;i<t;i++){let t=[];for(let i=0;i<e;i++){let e=new s;t.push(e)}this.matrix.push(t)}l.length>0?this.placeBombsFromCoordinates(l):this.placeBombs(this.numbombs)}get numBomb(){return this.numbombs}placeBombs(t){const e=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;let i=t;for(;i>0;){let t=(0,s=this.length-1,Math.floor(Math.random()*(s-0+1))+0),l=e(0,this.width-1);this.matrix[t][l].hasBomb()||(this.matrix[t][l].setBomb(),this.calculateCellWeight(t,l),i--)}var s}placeBombsFromCoordinates(t){t.forEach((({row:t,col:e})=>{t>=0&&t<this.length&&e>=0&&e<this.width&&(this.matrix[t][e].setBomb(),this.calculateCellWeight(t,e))}))}calculateCellWeight(t,e){t-1>=0&&t-1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t-1][e-1].hasBomb()&&this.matrix[t-1][e-1].setNumber(this.matrix[t-1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t-1][e].hasBomb()&&this.matrix[t-1][e].setNumber(this.matrix[t-1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t-1][e+1].hasBomb()&&this.matrix[t-1][e+1].setNumber(this.matrix[t-1][e+1].getNumber()+1)),t>=0&&t<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t][e-1].hasBomb()&&this.matrix[t][e-1].setNumber(this.matrix[t][e-1].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t][e+1].hasBomb()&&this.matrix[t][e+1].setNumber(this.matrix[t][e+1].getNumber()+1)),t+1>=0&&t+1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t+1][e-1].hasBomb()&&this.matrix[t+1][e-1].setNumber(this.matrix[t+1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t+1][e].hasBomb()&&this.matrix[t+1][e].setNumber(this.matrix[t+1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t+1][e+1].hasBomb()&&this.matrix[t+1][e+1].setNumber(this.matrix[t+1][e+1].getNumber()+1))}toString(){let t="";for(let e=0;e<this.length;e++){for(let i=0;i<this.width;i++)t+="| "+this.matrix[e][i].toString()+" |";t+="\n";for(let e=0;e<this.width;e++)t+="-----";t+="\n"}return t}revealCell(t,e,i){if(i)this.matrix[t][e].isVisible()||this.matrix[t][e].getExploded()||this.matrix[t][e].toggleFlag();else if(!this.matrix[t][e].isFlagged()&&!this.matrix[t][e].isVisible()&&(this.matrix[t][e].setVisible(),0===this.matrix[t][e].getNumber()&&!this.matrix[t][e].hasBomb())){const i=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(let[s,l]of i){let i=t+s,o=e+l;i>=0&&i<this.length&&o>=0&&o<this.width&&(this.matrix[i][o].isVisible()||this.revealCell(i,o))}}}revealNeighbours(t,e){let i=!1,s=[];const l=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],o=this.matrix[t][e].getNumber();let r=0;for(let[i,s]of l){let l=t+i,o=e+s;l>=0&&l<this.length&&o>=0&&o<this.width&&this.matrix[l][o].isFlagged()&&r++}if(r>=o)for(let[o,r]of l){let l=t+o,a=e+r;if(l>=0&&l<this.length&&a>=0&&a<this.width&&!this.matrix[l][a].isVisible()&&(this.revealCell(l,a),this.matrix[l][a].hasBomb()&&!this.matrix[l][a].isFlagged())){i=!0;const t=l,e=a;s.push({bombRow:t,bombCol:e})}}return{isBomb:i,bombsList:s}}}}},e={};function i(s){var l=e[s];if(void 0!==l)return l.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=i(886),e=i.n(t);document.addEventListener("startVersusGameEvent",(async function(t){const{numBombs:i,bombCoordinates:s,rows:l,cols:o}=t.detail,r=new(e())(l,o,i,s),a=document.getElementById("minesweeperCanvas"),n=a.getContext("2d");let h=1,m=!1,b=0,g=0,d=0,c=0;const u=document.getElementById("timer");let f=null,x=0,p=!1;const P=[],v=document.getElementById("bombsCanvas"),B=v.getContext("2d"),T=l,w=o,C=40;let N=C*w,S=C*T;function y(){p||(f=setInterval((()=>{x++,u.innerHTML=x.toString()}),1e3),p=!0)}function E(){p=!1,clearInterval(f)}function M(t){document.dispatchEvent(new CustomEvent("endVersusGame",{detail:{result:t}}))}function k(){let t=0,e=0,i=0,s=0;for(let l=0;l<T;l++)for(let o=0;o<w;o++){const a=r.matrix[l][o];a.isFlagged()&&a.getExploded()&&s++,a.hasBomb()&&t++,a.isFlagged()&&e++,a.isVisible()&&!a.hasBomb()&&i++}for(let t=0;t<T;t++)for(let e=0;e<w;e++){const i=r.matrix[t][e];if(i.hasBomb()&&!i.isVisible()&&!i.isFlagged())return!1}return t===e&&i===T*w-t&&(b=t-s,g=s,d=e-s,c=T*w-e,!0)}function F(){a.removeEventListener("click",V),a.removeEventListener("contextmenu",R)}function L(){const t={gameMode:"multi",numGamesPlayed:1,numGamesWon:0,numGamesLost:0,numBombsDefused:b,numBombsExploded:g,numFlagsPlaced:d,numCellsRevealed:c,averageTime:x,fastestTime:x,longestTime:x};fetch("/api/stats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>t.json())).then((t=>{})).catch((t=>{}))}function I(t,e){P.push(5),x+=5,r.matrix[t][e].setExploded(),r.matrix[t][e].isFlagged()||r.matrix[t][e].toggleFlag(),r.matrix[t][e].isVisible(),r.matrix[t][e].drawCellContent(n,t,e,C),W.innerHTML=(parseInt(W.innerHTML)-1).toString()}function V(t){const e=a.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,l=Math.floor(s/C*h),o=Math.floor(i/C*h);if(y(),r.matrix[l][o].isVisible()){if(r.matrix[l][o].getNumber()>0&&!r.matrix[l][o].hasBomb()){const{isBomb:t,bombsList:e}=r.revealNeighbours(l,o);if(t)for(const t of e){const e=t.bombRow,i=t.bombCol;r.matrix[e][i].getExploded()||I(e,i)}}}else r.revealCell(l,o,!1);n.clearRect(0,0,a.width,a.height);for(let t=0;t<T;t++)for(let e=0;e<w;e++)r.matrix[t][e].drawCellContent(n,t,e,C),n.strokeRect(e*C,t*C,C,C);!function(t,e){if(!r.matrix[t][e].isFlagged())return r.matrix[t][e].hasBomb()}(l,o)?k()&&(m=!0,E(),H=!0,F(),M(x),L()):r.matrix[l][o].getExploded()||I(l,o)}function R(t){t.preventDefault();const e=a.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,l=Math.floor(s/C),o=Math.floor(i/C);y(),r.revealCell(l,o,!0),n.clearRect(0,0,a.width,a.height);for(let t=0;t<T;t++)for(let e=0;e<w;e++)r.matrix[t][e].drawCellContent(n,t,e,C),n.strokeRect(e*C,t*C,C,C);r.matrix[l][o].isVisible()||!r.matrix[l][o].isFlagged()||r.matrix[l][o].getExploded()||(W.innerHTML=(parseInt(W.innerHTML)-1).toString()),r.matrix[l][o].isVisible()||r.matrix[l][o].isFlagged()||(W.innerHTML=(parseInt(W.innerHTML)+1).toString()),k()&&(m=!0,E(),H=!0,F(),M(x),L())}a.width=N,a.height=S;let H=!1;a.addEventListener("click",V),a.addEventListener("contextmenu",R),v.width=C,v.height=C,function(t,e,i,s,l){t.fillStyle="black",t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-s-4),t.lineTo(e,i+s+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-s-4,i),t.lineTo(e+s+4,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-s/1.5-4,i-s/1.5-4),t.lineTo(e+s/1.5+4,i+s/1.5+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+s/1.5+4,i-s/1.5-4),t.lineTo(e-s/1.5-4,i+s/1.5+4),t.stroke(),t.closePath(),t.lineWidth=1;const o=t.createLinearGradient(e-s,i-s,e+s/2,i+s/2);o.addColorStop(0,"grey"),o.addColorStop(1,"black"),t.fillStyle=o,t.beginPath(),t.arc(e,i,s-2,0,2*Math.PI),t.fill(),t.closePath(),t.fillStyle="black",t.beginPath(),t.arc(e,i,s/4,0,2*Math.PI),t.fill(),t.closePath()}(B,C/2,C/2,C/4);let W=document.getElementById("bombs");W.innerHTML=r.numbombs.toString();for(let t=0;t<T;t++)for(let e=0;e<w;e++)r.matrix[t][e].drawCellContent(n,t,e,C),n.strokeRect(e*C,t*C,C,C)}))})()})();