(()=>{var t={188:t=>{t.exports=class{constructor(){this.bomb=!1,this.number=0,this.visible=!1,this.flagged=!1,this.hasExploded=!1}isFlagged(){return this.flagged}toggleFlag(){this.flagged=!this.flagged}isVisible(){return this.visible}setVisible(){this.visible=!0}hasBomb(){return this.bomb}setBomb(){this.bomb=!0}setExploded(){this.hasExploded=!0}getExploded(){return this.hasExploded}getNumber(){return this.number}setNumber(t){this.number=t}toString(){return this.bomb?"B":this.number.toString()}drawBomb(t,e,i,o,l,s){t.fillStyle="black",t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-o-l),t.lineTo(e,i+o+l),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o-l,i),t.lineTo(e+o+l,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o/1.5-l,i-o/1.5-l),t.lineTo(e+o/1.5+l,i+o/1.5+l),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+o/1.5+l,i-o/1.5-l),t.lineTo(e-o/1.5-l,i+o/1.5+l),t.stroke(),t.closePath(),t.lineWidth=1;const r=t.createLinearGradient(e-o,i-o,e+o/2,i+o/2);r.addColorStop(0,"grey"),r.addColorStop(1,"black"),t.fillStyle=r,t.beginPath(),t.arc(e,i,o-2,0,2*Math.PI),t.fill(),t.closePath(),s?(t.fillStyle="red",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath()):(t.fillStyle="black",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath())}drawCellContent(t,e,i,o){const l=i*o+o/2,s=e*o+o/2,r=o/4;if(this.visible)if(this.hasBomb())this.getExploded()?this.drawBomb(t,l,s,r,4,!0):this.drawBomb(t,l,s,r,4);else{let l="#000000";if(1===this.getNumber())l="blue";else if(2===this.getNumber())l="green";else if(3===this.getNumber())l="red";else if(4===this.getNumber())l="#00008B";else if(5===this.getNumber())l="#8B0000";else if(6===this.getNumber())l="#00FFFF";else if(7===this.getNumber())l="black";else if(8===this.getNumber())l="grey";else if(0===this.getNumber())return;t.fillStyle="#f9f8f5",t.fillRect(i*o,e*o,o,o),t.fillStyle=l,t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.toString(),i*o+o/2,e*o+o/2)}else t.fillStyle="#999999",t.fillRect(i*o,e*o,o,o),this.flagged&&(t.fillStyle="#ff0000",t.beginPath(),t.moveTo(l-2,s+r),t.lineTo(l-3.5,s-1),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(l-3,s-1),t.lineTo(l-r/2,s-r-4),t.stroke(),t.lineTo(l+r+4,s-r/2-4),t.stroke(),t.lineTo(l-3,s-1),t.stroke(),t.closePath(),t.fill(),t.beginPath(),t.moveTo(l-8,s+r),t.lineTo(l+4,s+r),t.stroke(),t.closePath())}}},220:(t,e,i)=>{const o=i(188);t.exports=class{DIFFICULTY_NORMAL=.15;constructor(t,e,i,l=[]){this.length=t,this.width=e,this.matrix=[],this.numbombs=i;for(let i=0;i<t;i++){let t=[];for(let i=0;i<e;i++){let e=new o;t.push(e)}this.matrix.push(t)}l.length>0?this.placeBombsFromCoordinates(l):this.placeBombs(this.numbombs)}get numBomb(){return this.numbombs}placeBombs(t){const e=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;let i=t;for(;i>0;){let t=(0,o=this.length-1,Math.floor(Math.random()*(o-0+1))+0),l=e(0,this.width-1);this.matrix[t][l].hasBomb()||(this.matrix[t][l].setBomb(),this.calculateCellWeight(t,l),i--)}var o}placeBombsFromCoordinates(t){t.forEach((({row:t,col:e})=>{t>=0&&t<this.length&&e>=0&&e<this.width&&(this.matrix[t][e].setBomb(),this.calculateCellWeight(t,e))}))}calculateCellWeight(t,e){t-1>=0&&t-1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t-1][e-1].hasBomb()&&this.matrix[t-1][e-1].setNumber(this.matrix[t-1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t-1][e].hasBomb()&&this.matrix[t-1][e].setNumber(this.matrix[t-1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t-1][e+1].hasBomb()&&this.matrix[t-1][e+1].setNumber(this.matrix[t-1][e+1].getNumber()+1)),t>=0&&t<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t][e-1].hasBomb()&&this.matrix[t][e-1].setNumber(this.matrix[t][e-1].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t][e+1].hasBomb()&&this.matrix[t][e+1].setNumber(this.matrix[t][e+1].getNumber()+1)),t+1>=0&&t+1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t+1][e-1].hasBomb()&&this.matrix[t+1][e-1].setNumber(this.matrix[t+1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t+1][e].hasBomb()&&this.matrix[t+1][e].setNumber(this.matrix[t+1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t+1][e+1].hasBomb()&&this.matrix[t+1][e+1].setNumber(this.matrix[t+1][e+1].getNumber()+1))}toString(){let t="";for(let e=0;e<this.length;e++){for(let i=0;i<this.width;i++)t+="| "+this.matrix[e][i].toString()+" |";t+="\n";for(let e=0;e<this.width;e++)t+="-----";t+="\n"}return t}revealCell(t,e,i){if(i)this.matrix[t][e].isVisible()||this.matrix[t][e].getExploded()||this.matrix[t][e].toggleFlag();else if(!this.matrix[t][e].isFlagged()&&!this.matrix[t][e].isVisible()&&(this.matrix[t][e].setVisible(),0===this.matrix[t][e].getNumber()&&!this.matrix[t][e].hasBomb())){const i=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(let[o,l]of i){let i=t+o,s=e+l;i>=0&&i<this.length&&s>=0&&s<this.width&&(this.matrix[i][s].isVisible()||this.revealCell(i,s))}}}revealNeighbours(t,e){let i=!1,o=[];const l=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],s=this.matrix[t][e].getNumber();let r=0;for(let[i,o]of l){let l=t+i,s=e+o;l>=0&&l<this.length&&s>=0&&s<this.width&&this.matrix[l][s].isFlagged()&&r++}if(console.log("revealNeighbours:",s,": ",r),r===s)for(let[s,r]of l){let l=t+s,a=e+r;if(l>=0&&l<this.length&&a>=0&&a<this.width&&!this.matrix[l][a].isVisible()&&(this.revealCell(l,a),this.matrix[l][a].hasBomb()&&!this.matrix[l][a].isFlagged())){i=!0;const t=l,e=a;o.push({bombRow:t,bombCol:e})}}return console.log("bombs: ",o),{isBomb:i,bombsList:o}}}}},e={};function i(o){var l=e[o];if(void 0!==l)return l.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,i),s.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=i(220),e=i.n(t);document.addEventListener("DOMContentLoaded",(async function(){const t=document.getElementById("minesweeperCanvas"),i=t.getContext("2d");let o=1,l=!1;const s=document.getElementById("timer");let r=null,a=0,h=!1;const n=document.getElementById("bombsCanvas"),m=n.getContext("2d"),b=await fetch("/getGridInfo"),c=await b.json(),{rows:g,cols:d,bombs:f}=c,u=g,x=d,v=40;let P=v*x,B=v*u;function w(){h||(r=setInterval((()=>{a++,s.innerHTML=a.toString()}),1e3),h=!0)}function p(){h=!1,clearInterval(r)}function C(){for(let t=0;t<u;t++)for(let e=0;e<x;e++)if(L.matrix[t][e].hasBomb()&&!L.matrix[t][e].isVisible()&&!L.matrix[t][e].isFlagged())return!1;return!0}function N(){t.removeEventListener("click",M),t.removeEventListener("contextmenu",y)}function T(){l?document.getElementById("gameWin").style.display="flex":document.getElementById("gameOver").style.display="flex"}function k(){console.log("Game Over! You clicked on a bomb."),p(),I=!0,N(),T();for(let t=0;t<u;t++)for(let e=0;e<x;e++)L.matrix[t][e].hasBomb()&&L.matrix[t][e].setVisible();i.clearRect(0,0,t.width,t.height);for(let t=0;t<u;t++)for(let e=0;e<x;e++)L.matrix[t][e].drawCellContent(i,t,e,v),i.strokeRect(e*v,t*v,v,v)}function M(e){const s=t.getBoundingClientRect(),r=e.clientX-s.left,a=e.clientY-s.top,h=Math.floor(a/v*o),n=Math.floor(r/v*o);if(console.log(`Left-clicked on cell (${h}, ${n})`),w(),L.matrix[h][n].isVisible()){if(L.matrix[h][n].getNumber()>0&&!L.matrix[h][n].hasBomb()){const{isBomb:t,bombsList:e}=L.revealNeighbours(h,n);if(console.log(`isBomb: ${t}, bombList: ${e}`),t)for(const t of e){const e=t.bombRow,i=t.bombCol;if(!L.matrix[e][i].getExploded())return void k()}}}else L.revealCell(h,n,!1);i.clearRect(0,0,t.width,t.height);for(let t=0;t<u;t++)for(let e=0;e<x;e++)L.matrix[t][e].drawCellContent(i,t,e,v),i.strokeRect(e*v,t*v,v,v);!function(t,e){if(!L.matrix[t][e].isFlagged())return L.matrix[t][e].hasBomb()}(h,n)?C()&&(l=!0,p(),I=!0,N(),T()):k()}function y(e){e.preventDefault();const o=t.getBoundingClientRect(),s=e.clientX-o.left,r=e.clientY-o.top,a=Math.floor(r/v),h=Math.floor(s/v);console.log(`Right-clicked on cell (${a}, ${h})`),w(),L.revealCell(a,h,!0),i.clearRect(0,0,t.width,t.height);for(let t=0;t<u;t++)for(let e=0;e<x;e++)L.matrix[t][e].drawCellContent(i,t,e,v),i.strokeRect(e*v,t*v,v,v);!L.matrix[a][h].isVisible()&&L.matrix[a][h].isFlagged()&&(F.innerHTML=(parseInt(F.innerHTML)-1).toString()),L.matrix[a][h].isVisible()||L.matrix[a][h].isFlagged()||(F.innerHTML=(parseInt(F.innerHTML)+1).toString()),C()&&(l=!0,p(),console.log("Game Over! You win!"),I=!0,N(),T())}t.width=P,t.height=B;const S=Math.floor(u*x*.15),E=function(t,e,i){const o=[];for(;o.length<i;){const i=Math.floor(Math.random()*t),l=Math.floor(Math.random()*e);o.some((t=>t.row===i&&t.col===l))||o.push({row:i,col:l})}return o}(u,x,S);console.log(E,S);let I=!1;t.addEventListener("click",M),t.addEventListener("contextmenu",y);const L=new(e())(u,x,S,E);n.width=v,n.height=v,function(t,e,i,o,l){t.fillStyle="black",t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-o-4),t.lineTo(e,i+o+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o-4,i),t.lineTo(e+o+4,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o/1.5-4,i-o/1.5-4),t.lineTo(e+o/1.5+4,i+o/1.5+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+o/1.5+4,i-o/1.5-4),t.lineTo(e-o/1.5-4,i+o/1.5+4),t.stroke(),t.closePath(),t.lineWidth=1;const s=t.createLinearGradient(e-o,i-o,e+o/2,i+o/2);s.addColorStop(0,"grey"),s.addColorStop(1,"black"),t.fillStyle=s,t.beginPath(),t.arc(e,i,o-2,0,2*Math.PI),t.fill(),t.closePath(),t.fillStyle="black",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath()}(m,v/2,v/2,v/4);let F=document.getElementById("bombs");F.innerHTML=L.numbombs.toString();for(let t=0;t<u;t++)for(let e=0;e<x;e++)L.matrix[t][e].drawCellContent(i,t,e,v),i.strokeRect(e*v,t*v,v,v)}))})()})();