(()=>{var t={351:t=>{t.exports=class{constructor(){this.bomb=!1,this.number=0,this.visible=!1,this.flagged=!1,this.hasExploded=!1}isFlagged(){return this.flagged}toggleFlag(){this.flagged=!this.flagged}isVisible(){return this.visible}setVisible(){this.visible=!0}hasBomb(){return this.bomb}setBomb(){this.bomb=!0}setExploded(){this.hasExploded=!0}getExploded(){return this.hasExploded}getNumber(){return this.number}setNumber(t){this.number=t}toString(){return this.bomb?"B":this.number.toString()}drawBomb(t,e,i,o,s,r){t.fillStyle="black",t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-o-s),t.lineTo(e,i+o+s),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o-s,i),t.lineTo(e+o+s,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o/1.5-s,i-o/1.5-s),t.lineTo(e+o/1.5+s,i+o/1.5+s),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+o/1.5+s,i-o/1.5-s),t.lineTo(e-o/1.5-s,i+o/1.5+s),t.stroke(),t.closePath(),t.lineWidth=1;const l=t.createLinearGradient(e-o,i-o,e+o/2,i+o/2);l.addColorStop(0,"grey"),l.addColorStop(1,"black"),t.fillStyle=l,t.beginPath(),t.arc(e,i,o-2,0,2*Math.PI),t.fill(),t.closePath(),r?(t.fillStyle="red",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath()):(t.fillStyle="black",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath())}drawCellContent(t,e,i,o){const s=i*o+o/2,r=e*o+o/2,l=o/4;if(this.visible)if(this.hasBomb())this.getExploded()?this.drawBomb(t,s,r,l,4,!0):this.drawBomb(t,s,r,l,4);else{let s="#000000";if(1===this.getNumber())s="blue";else if(2===this.getNumber())s="green";else if(3===this.getNumber())s="red";else if(4===this.getNumber())s="#00008B";else if(5===this.getNumber())s="#8B0000";else if(6===this.getNumber())s="#00FFFF";else if(7===this.getNumber())s="black";else if(8===this.getNumber())s="grey";else if(0===this.getNumber())return;t.fillStyle="#f9f8f5",t.fillRect(i*o,e*o,o,o),t.fillStyle=s,t.font="20px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(this.toString(),i*o+o/2,e*o+o/2)}else t.fillStyle="#999999",t.fillRect(i*o,e*o,o,o),this.flagged&&(t.fillStyle="#ff0000",t.beginPath(),t.moveTo(s-2,r+l),t.lineTo(s-3.5,r-1),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(s-3,r-1),t.lineTo(s-l/2,r-l-4),t.stroke(),t.lineTo(s+l+4,r-l/2-4),t.stroke(),t.lineTo(s-3,r-1),t.stroke(),t.closePath(),t.fill(),t.beginPath(),t.moveTo(s-8,r+l),t.lineTo(s+4,r+l),t.stroke(),t.closePath())}}},886:(t,e,i)=>{const o=i(351);t.exports=class{DIFFICULTY_NORMAL=.15;constructor(t,e,i,s=[]){this.length=t,this.width=e,this.matrix=[],this.numbombs=i;for(let i=0;i<t;i++){let t=[];for(let i=0;i<e;i++){let e=new o;t.push(e)}this.matrix.push(t)}s.length>0?this.placeBombsFromCoordinates(s):this.placeBombs(this.numbombs)}get numBomb(){return this.numbombs}placeBombs(t){const e=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;let i=t;for(;i>0;){let t=(0,o=this.length-1,Math.floor(Math.random()*(o-0+1))+0),s=e(0,this.width-1);this.matrix[t][s].hasBomb()||(this.matrix[t][s].setBomb(),this.calculateCellWeight(t,s),i--)}var o}placeBombsFromCoordinates(t){t.forEach((({row:t,col:e})=>{t>=0&&t<this.length&&e>=0&&e<this.width&&(this.matrix[t][e].setBomb(),this.calculateCellWeight(t,e))}))}calculateCellWeight(t,e){t-1>=0&&t-1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t-1][e-1].hasBomb()&&this.matrix[t-1][e-1].setNumber(this.matrix[t-1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t-1][e].hasBomb()&&this.matrix[t-1][e].setNumber(this.matrix[t-1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t-1][e+1].hasBomb()&&this.matrix[t-1][e+1].setNumber(this.matrix[t-1][e+1].getNumber()+1)),t>=0&&t<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t][e-1].hasBomb()&&this.matrix[t][e-1].setNumber(this.matrix[t][e-1].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t][e+1].hasBomb()&&this.matrix[t][e+1].setNumber(this.matrix[t][e+1].getNumber()+1)),t+1>=0&&t+1<this.length&&(e-1>=0&&e-1<this.width&&!this.matrix[t+1][e-1].hasBomb()&&this.matrix[t+1][e-1].setNumber(this.matrix[t+1][e-1].getNumber()+1),e>=0&&e<this.width&&!this.matrix[t+1][e].hasBomb()&&this.matrix[t+1][e].setNumber(this.matrix[t+1][e].getNumber()+1),e+1>=0&&e+1<this.width&&!this.matrix[t+1][e+1].hasBomb()&&this.matrix[t+1][e+1].setNumber(this.matrix[t+1][e+1].getNumber()+1))}toString(){let t="";for(let e=0;e<this.length;e++){for(let i=0;i<this.width;i++)t+="| "+this.matrix[e][i].toString()+" |";t+="\n";for(let e=0;e<this.width;e++)t+="-----";t+="\n"}return t}revealCell(t,e,i){if(i)this.matrix[t][e].isVisible()||this.matrix[t][e].getExploded()||this.matrix[t][e].toggleFlag();else if(!this.matrix[t][e].isFlagged()&&!this.matrix[t][e].isVisible()&&(this.matrix[t][e].setVisible(),0===this.matrix[t][e].getNumber()&&!this.matrix[t][e].hasBomb())){const i=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];for(let[o,s]of i){let i=t+o,r=e+s;i>=0&&i<this.length&&r>=0&&r<this.width&&(this.matrix[i][r].isVisible()||this.revealCell(i,r))}}}revealNeighbours(t,e){let i=!1,o=[];const s=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],r=this.matrix[t][e].getNumber();let l=0;for(let[i,o]of s){let s=t+i,r=e+o;s>=0&&s<this.length&&r>=0&&r<this.width&&this.matrix[s][r].isFlagged()&&l++}if(l>=r)for(let[r,l]of s){let s=t+r,n=e+l;if(s>=0&&s<this.length&&n>=0&&n<this.width&&!this.matrix[s][n].isVisible()&&(this.revealCell(s,n),this.matrix[s][n].hasBomb()&&!this.matrix[s][n].isFlagged())){i=!0;const t=s,e=n;o.push({bombRow:t,bombCol:e})}}return{isBomb:i,bombsList:o}}}}},e={};function i(o){var s=e[o];if(void 0!==s)return s.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=i(886),e=i.n(t);function o(t){const e=t+"=",i=decodeURIComponent(document.cookie).split(";");for(let t=0;t<i.length;t++){let o=i[t];for(;" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(e))return o.substring(e.length,o.length)}return null}document.addEventListener("DOMContentLoaded",(async function(){const t=document.getElementById("minesweeperCanvas"),i=t.getContext("2d");let s=!1,r=0,l=0,n=0,a=0;const h=document.getElementById("timer");let m=null,c=0,b=!1;const d=document.getElementById("bombsCanvas"),g=d.getContext("2d"),f=o("rows"),u=o("cols"),x=f,v=u,w=40;let B=w*v,p=w*x;const P=500;let T,C=0,N=0;t.width=B,t.height=p;let y=1;const k=(e,i)=>{const o=t.getBoundingClientRect(),s=e-o.left,r=i-o.top;return{row:Math.floor(r/(w*y)),col:Math.floor(s/(w*y))}};function M(){const e=B*y,o=p*y;t.width=e,t.height=o,i.clearRect(0,0,t.width,t.height),i.setTransform(1,0,0,1,0,0),i.scale(y,y);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w)}function E(){b||(m=setInterval((()=>{c++,h.innerHTML=c.toString()}),1e3),b=!0)}function L(){b=!1,clearInterval(m)}function S(t,e){if(!_.matrix[t][e].isFlagged()){if(_.matrix[t][e].hasBomb()){l=1;for(let t=0;t<x;t++)for(let e=0;e<v;e++){const i=_.matrix[t][e];i.isVisible()&&a++,i.isFlagged()&&n++,i.isFlagged()&&i.hasBomb()&&r++}return console.log("Lose: ",l,r,n,a),!0}return!1}}function I(){r=0,l=0,n=0,a=0;let t=0,e=0,i=0;for(let o=0;o<x;o++)for(let s=0;s<v;s++){const r=_.matrix[o][s];r.hasBomb()&&t++,r.isFlagged()&&e++,r.isVisible()&&!r.hasBomb()&&i++}for(let t=0;t<x;t++)for(let e=0;e<v;e++){const i=_.matrix[t][e];if(i.hasBomb()&&!i.isVisible()&&!i.isFlagged())return!1}return t===e&&i===x*v-t&&(r=t,n=e,a=x*v-e,!0)}function F(){t.removeEventListener("touchstart",W),t.removeEventListener("touchend",D)}function R(){t.removeEventListener("click",G),t.removeEventListener("contextmenu",Y)}function V(){s?document.getElementById("gameWin").style.display="flex":document.getElementById("gameOver").style.display="flex"}function H(){const t={gameMode:"solo",numGamesPlayed:1,numGamesWon:s?1:0,numGamesLost:s?0:1,numBombsDefused:r,numBombsExploded:l,numFlagsPlaced:n,numCellsRevealed:a,averageTime:c,fastestTime:c,longestTime:c};fetch("/api/stats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>t.json())).then((t=>{console.log("Success:",t)})).catch((t=>{console.error("Error:",t)}))}function O(){L(),X=!0,R(),V(),H();for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].hasBomb()&&_.matrix[t][e].setVisible();i.clearRect(0,0,t.width,t.height);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w)}function W(e){e.preventDefault();const{row:o,col:r}=k(e.changedTouches[0].clientX,e.changedTouches[0].clientY);E(),C=o,N=r,T=setTimeout((()=>{_.revealCell(o,r,!0),i.clearRect(0,0,t.width,t.height);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w);!_.matrix[o][r].isVisible()&&_.matrix[o][r].isFlagged()&&(z.innerHTML=(parseInt(z.innerHTML)-1).toString()),_.matrix[o][r].isVisible()||_.matrix[o][r].isFlagged()||(z.innerHTML=(parseInt(z.innerHTML)+1).toString()),I()&&(s=!0,L(),X=!0,R(),F(),V(),H())}),P)}function D(e){e.preventDefault(),clearTimeout(T);const{row:o,col:r}=k(e.changedTouches[0].clientX,e.changedTouches[0].clientY);if(E(),_.matrix[o][r].isVisible()){if(_.matrix[o][r].isVisible()&&_.matrix[o][r].getNumber()>0&&!_.matrix[o][r].hasBomb()){const{isBomb:t,bombsList:e}=_.revealNeighbours(o,r);if(t)for(const t of e){const e=t.bombRow,i=t.bombCol;if(!_.matrix[e][i].getExploded())return void O()}}}else _.revealCell(o,r,!1);i.clearRect(0,0,t.width,t.height);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w);S(o,r)?O():I()&&(s=!0,L(),X=!0,R(),F(),V(),H())}function G(e){const{row:o,col:r}=k(e.clientX,e.clientY);if(E(),_.matrix[o][r].isVisible()){if(_.matrix[o][r].getNumber()>0&&!_.matrix[o][r].hasBomb()){const{isBomb:t,bombsList:e}=_.revealNeighbours(o,r);if(t)for(const t of e){const e=t.bombRow,i=t.bombCol;if(!_.matrix[e][i].getExploded())return void O()}}}else _.revealCell(o,r,!1);i.clearRect(0,0,t.width,t.height);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w);S(o,r)?O():I()&&(s=!0,L(),X=!0,R(),F(),V(),H())}function Y(e){e.preventDefault();const{row:o,col:r}=k(e.clientX,e.clientY);E(),_.revealCell(o,r,!0),i.clearRect(0,0,t.width,t.height);for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w);!_.matrix[o][r].isVisible()&&_.matrix[o][r].isFlagged()&&(z.innerHTML=(parseInt(z.innerHTML)-1).toString()),_.matrix[o][r].isVisible()||_.matrix[o][r].isFlagged()||(z.innerHTML=(parseInt(z.innerHTML)+1).toString()),I()&&(s=!0,L(),X=!0,R(),F(),V(),H())}document.getElementById("zoomInButton").addEventListener("click",(function(){y+=.1,M()})),document.getElementById("zoomOutButton").addEventListener("click",(function(){y-=.1,M()}));const j=Math.floor(x*v*.15),A=function(t,e,i){const o=[];for(;o.length<i;){const i=Math.floor(Math.random()*t),s=Math.floor(Math.random()*e);o.some((t=>t.row===i&&t.col===s))||o.push({row:i,col:s})}return o}(x,v,j);let X=!1;t.addEventListener("click",G),t.addEventListener("contextmenu",Y),t.addEventListener("touchstart",W),t.addEventListener("touchend",D);const _=new(e())(x,v,j,A);d.width=w,d.height=w,function(t,e,i,o,s){t.fillStyle="black",t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.fill(),t.closePath(),t.lineWidth=4,t.beginPath(),t.moveTo(e,i-o-4),t.lineTo(e,i+o+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o-4,i),t.lineTo(e+o+4,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e-o/1.5-4,i-o/1.5-4),t.lineTo(e+o/1.5+4,i+o/1.5+4),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(e+o/1.5+4,i-o/1.5-4),t.lineTo(e-o/1.5-4,i+o/1.5+4),t.stroke(),t.closePath(),t.lineWidth=1;const r=t.createLinearGradient(e-o,i-o,e+o/2,i+o/2);r.addColorStop(0,"grey"),r.addColorStop(1,"black"),t.fillStyle=r,t.beginPath(),t.arc(e,i,o-2,0,2*Math.PI),t.fill(),t.closePath(),t.fillStyle="black",t.beginPath(),t.arc(e,i,o/4,0,2*Math.PI),t.fill(),t.closePath()}(g,w/2,w/2,w/4);let z=document.getElementById("bombs");z.innerHTML=_.numbombs.toString();for(let t=0;t<x;t++)for(let e=0;e<v;e++)_.matrix[t][e].drawCellContent(i,t,e,w),i.strokeRect(e*w,t*w,w,w)}))})()})();